<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>BNK 상품 상세</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" th:href="@{/css/common.css}" />
  <link rel="stylesheet" th:href="@{/css/productDetail.css}" />
  <link rel="stylesheet" th:href="@{/css/dictionary-button.css}" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@900&family=Noto+Sans+KR:wght@700;900&display=swap" rel="stylesheet" />
</head>
<body>

<div th:replace="~{fragments/header2 :: header}"></div>

<!-- ✅ 탭 + 슬라이드 구조 -->
<div class="slider-container">
  <div class="left-panel">
    <div class="product-title" id="productTitle">상품명</div>
    <div class="tab-buttons" id="tabButtons"></div>
  </div>
  <div class="slide-area">
    <div class="arrow-group">
      <div class="arrow" onclick="prevSlide()">‹</div>
      <div class="arrow" onclick="nextSlide()">›</div>
    </div>
    <div id="slideImagesWrapper"></div>
  </div>
</div>

<!-- ✅ 아코디언 정보 영역 -->
<div class="accordion-area-wrap">
  <div class="accordion-wrap">
    <div class="accordion-item">
      <button class="accordion-header" onclick="toggleAccordion(this)">
        상품개요 <span class="accordion-arrow">▼</span>
      </button>
      <div class="accordion-body">
        <table class="detail-table">
          <tr><th>설명</th><td th:text="${attributes['PR001'][0].avalue}">내용</td></tr>
        </table>
      </div>
    </div>

    <div class="accordion-item">
      <button class="accordion-header" onclick="toggleAccordion(this)">
        가입조건 <span class="accordion-arrow">▼</span>
      </button>
      <div class="accordion-body">
        <table class="detail-table">
          <tr><th>가입대상</th><td th:text="${attributes['PR005'][0].avalue}">내용</td></tr>
          <tr><th>가입금액</th><td th:text="${attributes['PR006'][0].avalue}">내용</td></tr>
          <tr><th>가입기간</th><td th:text="${attributes['PR007'][0].avalue}">내용</td></tr>
          <tr><th>납입한도</th><td th:text="${attributes['PR008'][0].avalue}">내용</td></tr>
        </table>
      </div>
    </div>

    <div class="accordion-item">
      <button class="accordion-header" onclick="toggleAccordion(this)">
        금리정보 <span class="accordion-arrow">▼</span>
      </button>
      <div class="accordion-body">
        <table class="detail-table">
          <tr><th>기본금리</th><td th:text="${attributes['PR014'][0].avalue}">내용</td></tr>
          <tr><th>우대금리</th><td th:text="${attributes['PR015'][0].avalue}">내용</td></tr>
        </table>
      </div>
    </div>

    <div class="accordion-item">
      <button class="accordion-header" onclick="toggleAccordion(this)">
        만기·중도해지 이율 <span class="accordion-arrow">▼</span>
      </button>
      <div class="accordion-body">
        <table class="detail-table">
          <tr><th>만기 후</th><td th:text="${attributes['PR017'][0].avalue}">내용</td></tr>
          <tr><th>중도해지</th><td th:text="${attributes['PR018'][0].avalue}">내용</td></tr>
          <tr><th>특별중도해지</th><td th:text="${attributes['PR019'][0].avalue}">내용</td></tr>
        </table>
      </div>
    </div>

    <div class="accordion-item">
      <button class="accordion-header" onclick="toggleAccordion(this)">
        기타 정보 <span class="accordion-arrow">▼</span>
      </button>
      <div class="accordion-body">
        <table class="detail-table">
          <tr><th>이자지급</th><td th:text="${attributes['PR020'][0].avalue}">내용</td></tr>
          <tr><th>적립방법</th><td th:text="${attributes['PR024'][0].avalue}">내용</td></tr>
          <tr><th>예금자보호</th><td th:text="${attributes['PR035'][0].avalue}">내용</td></tr>
          <tr><th>공시승인번호</th><td th:text="${attributes['PR038'][0].avalue}">내용</td></tr>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- 고정 사전 버튼 & 푸터 -->
<div th:replace="fragments/dictionary-button :: dictionary-button"></div>
<div th:replace="~{fragments/footer :: footer}"></div>

<!-- ✅ 스크립트 -->
<script>
  const products = [
    { pno: "P001", name: "꿈이룸 외화자유적금", imgPrefix: "m1", imageCount: 6 },
    { pno: "P002", name: "BNK모아드림외화적금", imgPrefix: "m5", imageCount: 6 },
    { pno: "P003", name: "BNK UP & UP 외화정기예금", imgPrefix: "m4", imageCount: 6 },
    { pno: "P004", name: "업앤업 외화MMDA", imgPrefix: "m2", imageCount: 6 },
    { pno: "P005", name: "EASY 환테크 듀얼통장", imgPrefix: "m3", imageCount: 6 },
    { pno: "P006", name: "외화정기예금", imgPrefix: "m6", imageCount: 6 },
    { pno: "P007", name: "외화당좌예금", imgPrefix: "m7", imageCount: 6 },
    { pno: "P008", name: "외화보통예금", imgPrefix: "m8", imageCount: 6 }
  ];

  const tabLabels = ["", "추천 대상", "상품 특징", "핵심 요약", "예금자보호", "가입"];
  let currentIndex = 0;
  let slides = [], tabs = [];

  function getPnoFromURL() {
    const params = new URLSearchParams(window.location.search);
    return params.get("pno") || "P001";
  }

  function buildSlider(product) {
    document.getElementById("productTitle").textContent = product.name;
    const tabWrapper = document.getElementById("tabButtons");
    tabWrapper.innerHTML = "";
    tabs = [];

    const total = Math.min(1 + product.imageCount, 6);
    for (let i = 0; i < 6; i++) {
      const btn = document.createElement("button");
      btn.type = "button";
      btn.className = "tab-btn" + (i === 0 ? " star" : "");
      if (i >= total) {
        btn.classList.add("disabled");
        btn.disabled = true;
      }
      btn.innerHTML = i === 0 ? "<span></span>" : `<span>${tabLabels[i]}</span>`;
      btn.addEventListener("click", () => {
        if (!btn.disabled) changeSlide(i);
      });
      tabWrapper.appendChild(btn);
      tabs.push(btn);
    }

    const imgWrapper = document.getElementById("slideImagesWrapper");
    imgWrapper.innerHTML = "";
    slides = [];

    for (let i = 0; i < 6; i++) {
      const img = document.createElement("img");
      img.className = "slide-img";
      img.src = `img/main/${product.imgPrefix}_${i+1}.png`;
      img.alt = tabLabels[i] || "별";
      if (i >= total) img.style.display = "none";
      imgWrapper.appendChild(img);
      slides.push(img);
    }

    changeSlide(0, true);
  }

  function changeSlide(index, init=false) {
    slides.forEach((img, i) => {
      const active = i === index && !tabs[i].disabled;
      img.classList.toggle("active", active);
      img.style.display = tabs[i].disabled ? "none" : (active ? "block" : "none");
    });
    tabs.forEach((btn, i) => {
      btn.classList.toggle("active", i === index && !btn.disabled);
    });
    currentIndex = index;
    if (!init && tabs[index].disabled) nextSlide();
  }

  function prevSlide() {
    let idx = currentIndex;
    do { idx = (idx - 1 + tabs.length) % tabs.length; }
    while (tabs[idx].disabled);
    changeSlide(idx);
  }

  function nextSlide() {
    let idx = currentIndex;
    do { idx = (idx + 1) % tabs.length; }
    while (tabs[idx].disabled);
    changeSlide(idx);
  }

  function toggleAccordion(btn) {
    const item = btn.parentNode;
    item.classList.toggle("active");
    btn.querySelector(".accordion-arrow").textContent = item.classList.contains("active") ? "▲" : "▼";
  }

  document.addEventListener("DOMContentLoaded", () => {
    const pno = getPnoFromURL();
    const product = products.find(p => p.pno === pno) || products[0];
    buildSlider(product);
  });
</script>
</body>
</html>