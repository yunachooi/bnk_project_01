<div th:fragment="header">
  <div class="topbar">
    <div class="topbar-container">
      <a href="#">KR</a><span class="separator">Β·</span>
      <a href="#">EN</a><span class="separator">Β·</span>
      <a href="#">CN</a>
      <a href="#" class="global-link">μ€ν–‰μ†κ°</a>
    </div>
  </div>
  <nav>
    <div class="nav-container">
      <div class="navbar-top">
        <div class="navbar-top-left">
          <div class="logo">BNK λ¶€μ‚°μ€ν–‰</div>
          <ul class="primary-nav">
            <li><a href="#">κ°μΈ</a></li>
            <li><a href="#">κΈ°μ—…</a></li>
            <li><a href="#" class="active">κΈμµμƒν’</a></li>
          </ul>
        </div>
<div class="user-actions">
  <span th:if="${session.username != null}">
    <span>
      ν™μν•©λ‹λ‹¤, <strong th:text="${session.username}">μ‚¬μ©μ</strong>λ‹
    </span>
    <a th:href="@{/logout}">λ΅κ·Έμ•„μ›ƒ</a>
  </span>

  <span th:unless="${session.username != null}">
    <a th:href="@{/login}">λ΅κ·ΈμΈ</a>
    <a href="#">μΈμ¦μ„Όν„°</a>
  </span>

  <a href="#" class="search-toggle" id="searchToggle">κ²€μƒ‰ν•κΈ°</a>
</div>
      </div>
      <div class="search-dropdown" id="searchDropdown">
        <div class="dropdown-inner">
          <div class="search-box">
            <input type="text" id="searchInput" placeholder="κ²€μƒ‰ν•  λ‚΄μ©μ„ μ…λ ¥ν•΄ μ£Όμ„Έμ”">
            <button id="searchBtn">κ²€μƒ‰ν•κΈ°</button>
          </div>
          <div class="suggestions-title">μ¶”μ² κ²€μƒ‰μ–΄</div>
          <ul class="search-suggestions">
            <li><a href="#">μκΈ</a></li>
            <li><a href="#">λ€μ¶</a></li>
            <li><a href="#">μ™Έν™</a></li>
            <li><a href="#">ν€λ“</a></li>
            <li><a href="#">μΉ΄λ“</a></li>
          </ul>
        </div>
      </div>
      <ul class="navbar-submenu">
        <li><a href="#">μκΈ</a><div class="dropdown placeholder"><div class="dropdown-inner">μ•„μ§ μ¤€λΉ„ μ¤‘μ…λ‹λ‹¤.</div></div></li>
        <li><a href="#">κ³¨λ“λ°”</a><div class="dropdown placeholder"><div class="dropdown-inner">μ•„μ§ μ¤€λΉ„ μ¤‘μ…λ‹λ‹¤.</div></div></li>
        <li><a href="#">μ‹ νƒ</a><div class="dropdown placeholder"><div class="dropdown-inner">μ•„μ§ μ¤€λΉ„ μ¤‘μ…λ‹λ‹¤.</div></div></li>
        <li><a href="#">μ›°μ¤νƒ€λ΅λ³΄B</a><div class="dropdown placeholder"><div class="dropdown-inner">μ•„μ§ μ¤€λΉ„ μ¤‘μ…λ‹λ‹¤.</div></div></li>
        <li><a href="#">ν€λ“</a><div class="dropdown placeholder"><div class="dropdown-inner">μ•„μ§ μ¤€λΉ„ μ¤‘μ…λ‹λ‹¤.</div></div></li>
        <li><a href="#">λ€μ¶</a><div class="dropdown placeholder"><div class="dropdown-inner">μ•„μ§ μ¤€λΉ„ μ¤‘μ…λ‹λ‹¤.</div></div></li>
        <li><a href="#">μΉ΄λ“</a><div class="dropdown placeholder"><div class="dropdown-inner">μ•„μ§ μ¤€λΉ„ μ¤‘μ…λ‹λ‹¤.</div></div></li>
        <li><a href="#">λ³΄ν—/κ³µμ </a><div class="dropdown placeholder"><div class="dropdown-inner">μ•„μ§ μ¤€λΉ„ μ¤‘μ…λ‹λ‹¤.</div></div></li>
        <li>
          <a href="/forex" class="submenu-exchange-active">μ™Έν™</a>
          <div class="dropdown forex-menu">
            <div class="dropdown-inner">
              <div class="mega-menu">
                <div class="mega-column">
                  <h4>μ™Έν™”μκΈ</h4>
                  <ul>
                    <li><a href="/product" class="active-link">μ™Έν™”μκΈμƒν’</a></li>
                    <li><a href="#" class="inactive-link">μ™Έν™”μκΈμ•λ‚΄</a></li>
                    <li><a href="#" class="inactive-link">μ™Έν™”μκΈμ°λ€μ„λΉ„μ¤</a></li>
                  </ul>
                </div>
                <div class="mega-column">
                  <h4>μ™Έν™”μ†΅κΈ</h4>
                  <ul>
                    <li><a href="#" class="inactive-link">μ™Έν™”μ†΅κΈμ„λΉ„μ¤</a></li>
                    <li><a href="#" class="inactive-link">μ™Έν™”μ†΅κΈλ³΄λ‚΄κΈ°</a></li>
                    <li><a href="#" class="inactive-link">μ™Έν™”μ†΅κΈλ°›κΈ°</a></li>
                  </ul>
                </div>
                <div class="mega-column">
                  <h4>μμ¶μ…κΈμµ</h4>
                  <ul>
                    <li><a href="#" class="inactive-link">μμ¶μ—…λ¬΄</a></li>
                    <li><a href="/user/import" class="active-link">μμ…μ—…λ¬΄</a></li>
                    <li><a href="#" class="inactive-link">λ‚΄κµ­μ‹ μ©μ¥/λ¬΄μ—­κΈμµ</a></li>
                    <li><a href="#" class="inactive-link">μ „μλ¬΄μ—­</a></li>
                    <li><a href="#" class="inactive-link">μμ¶μ…ν†µκ΄€ μƒλ‹΄ μ„λΉ„μ¤ μ•λ‚΄</a></li>
                  </ul>
                </div>
                <div class="mega-column">
                  <h4>κµ­λ‚΄μ™Έν¬μ</h4>
                  <ul>
                    <li><a href="#" class="inactive-link">ν•΄μ™Έμ§μ ‘ν¬μ</a></li>
                    <li><a href="#" class="inactive-link">ν•΄μ™Έμ‚¬λ¬΄μ†(μ§€μ‚¬)μ„¤μΉ</a></li>
                    <li><a href="#" class="inactive-link">ν•΄μ™Έλ¶€λ™μ‚°ν¬μ</a></li>
                    <li><a href="#" class="inactive-link">μ™Έκµ­μΈκµ­λ‚΄ν¬μ</a></li>
                    <li><a href="#" class="inactive-link">μ™Έκµ­μΈκµ­λ‚΄λ¶€λ™μ‚°ν¬μ</a></li>
                  </ul>
                </div>
                <div class="mega-column">
                  <h4>ν™μ „</h4>
                  <ul>
                    <li><a href="#" class="inactive-link">ν™μ „μ•λ‚΄</a></li>
                    <li><a href="/forexProduct" class="active-link">ν™μ „μ„λΉ„μ¤μ•λ‚΄</a></li>
                    <li><a href="#" class="inactive-link">ν™μ¨μ°λ€</a></li>
                    <li><a href="#" class="inactive-link">ν™μ „κ³„μ‚°κΈ°</a></li>
                    <li><a href="#" class="inactive-link">λ™λ¶μ•„ν—λΈμμ—…μ </a></li>
                    <li><a href="#" class="inactive-link">μ™Έν™”μν‘λ§¤μ…μ•λ‚΄</a></li>
                  </ul>
                </div>
                <div class="mega-column">
                  <h4>ν™μ¨</h4>
                  <ul>
                    <li><a href="#" class="inactive-link">ν™μ¨μ κ³µμ„λΉ„μ¤</a></li>
                    <li><a href="#" class="inactive-link">μ™Έν™μ‹μ¥λ™ν–¥</a></li>
                    <li><a href="#" class="inactive-link">ν™λ¦¬μ¤ν¬κ΄€λ¦¬</a></li>
                    <li><a href="/forexEvent" class="active-link">ν™μ¨μ°λ€μΏ ν°</a></li>
                  </ul>
                </div>
                <div class="mega-column">
                  <h4>μ ν•™/μ΄μ£Ό/μ—¬ν–‰</h4>
                  <ul>
                    <li><a href="#" class="inactive-link">μ ν•™</a></li>
                    <li><a href="#" class="inactive-link">μ΄μ£Ό</a></li>
                    <li><a href="#" class="inactive-link">μ—¬ν–‰</a></li>
                  </ul>
                </div>
                <div class="mega-column">
                  <h4>λ¶€κ°€μ„λΉ„μ¤</h4>
                  <ul>
                    <li><a href="#" class="inactive-link">ν™μ¨/μ΄μ¨μ΅°ν</a></li>
                    <li><a href="#" class="inactive-link">μ™Έν™μ„μ‹ ν”„λ΅κ·Έλ¨</a></li>
                  </ul>
                </div>
                <div class="mega-column">
                  <h4>κΈ€λ΅λ²νμ›μ…€λ¬ νΉν™”μ„λΉ„μ¤</h4>
                  <ul>
                    <li><a href="#" class="inactive-link">μ„λΉ„μ¤ μ•λ‚΄</a></li>
                  </ul>
                </div>
                <div class="mega-column">
                  <h4>μ™Έν™μ΄μ©κ°€μ΄λ“</h4>
                  <ul>
                    <li><a href="#" class="inactive-link">μ™Έν™μƒλ‹΄μ•λ‚΄</a></li>
                    <li><a href="#" class="inactive-link">λ²•κ·/κ·μ •</a></li>
                    <li><a href="#" class="inactive-link">μμλ£</a></li>
                    <li><a href="#" class="inactive-link">μ™Έν™FAQ</a></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </li>
        <li><a href="#">ν‡΄μ§μ—°κΈ</a><div class="dropdown placeholder"><div class="dropdown-inner">μ•„μ§ μ¤€λΉ„ μ¤‘μ…λ‹λ‹¤.</div></div></li>
        <li><a href="#">μ„λ―ΌκΈμµ</a><div class="dropdown placeholder"><div class="dropdown-inner">μ•„μ§ μ¤€λΉ„ μ¤‘μ…λ‹λ‹¤.</div></div></li>
        <li><a href="#">κµ­λ―Όμ£Όνƒμ±„κ¶</a><div class="dropdown placeholder"><div class="dropdown-inner">μ•„μ§ μ¤€λΉ„ μ¤‘μ…λ‹λ‹¤.</div></div></li>
      </ul>
    </div>
  </nav>
  
  <!-- μ„λΈλ©”λ‰΄ ν€µ -->
  <div class="submenu-quick">
  <ul>
  <li th:classappend="${requestURI == '/forex'} ? 'active'">
    <a href="/forex">λ©”μΈ</a>
  </li>
  <li th:classappend="${requestURI.contains('/product')} ? 'active'">
    <a href="/product">μ™Έν™”μκΈ</a>
  </li>
  <li th:classappend="${requestURI.contains('/user/import')} ? 'active'">
    <a href="/user/import">μμ…μ—…λ¬΄</a>
  </li>
  <li th:classappend="${requestURI == '/forexProduct'} ? 'active'">
    <a href="/forexProduct">ν™μ „</a>
  </li>
  <li th:classappend="${requestURI == '/forexEvent'} ? 'active'">
    <a href="/forexEvent">ν™μ¨μ°λ€μΏ ν°</a>
  </li>
</ul>
  </div>

  <!-- κ²€μƒ‰ λ“λ΅­λ‹¤μ΄ JS -->
  <script>
    const searchToggle = document.getElementById('searchToggle');
    const searchDropdown = document.getElementById('searchDropdown');
    searchToggle.addEventListener('click', e => {
      e.preventDefault();
      searchDropdown.classList.toggle('open');
    });
    document.addEventListener('click', e => {
      if (!searchDropdown.contains(e.target) && e.target !== searchToggle) {
        searchDropdown.classList.remove('open');
      }
    });

    window.addEventListener('scroll', () => {
        document.querySelectorAll('.dropdown').forEach(d => {
          d.style.display = 'none';        // μ°μ„  κ°μ¶¤
          d.dataset.closedByScroll = '1';  // π‘‰ ν‘μ‹λ§ λ‚¨κΉ€
        });
      });

      // 2) λ‹¤μ‹ λ©”λ‰΄μ— μ¬λΌμ¤λ©΄ styleΒ κ°’μ„ μ΄κΈ°ν™”
      document.querySelectorAll('.navbar-submenu li').forEach(li => {
        li.addEventListener('mouseenter', () => {
          const dd = li.querySelector('.dropdown');
          if (dd && dd.dataset.closedByScroll) {
            dd.style.display = '';         // μΈλΌμΈ μ κ±°
            delete dd.dataset.closedByScroll;
          }
        });
      });
  </script>
</div>