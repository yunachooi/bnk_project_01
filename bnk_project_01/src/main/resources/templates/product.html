<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>BNK 외화예금</title>
  <link rel="stylesheet" th:href="@{/css/common.css}" />
  <link rel="stylesheet" th:href="@{/css/dictionary-button.css}" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap">
  <style>
    * { box-sizing: border-box; }
    html, body { height:100%; }
    body {
      margin:0; font-family:'Noto Sans KR',sans-serif; color:#212d49; background:#fff;
      transition: background 0.3s, color 0.3s;
    }
    .container-main {
      width: 1000px; max-width: 98vw;
      margin: 0 auto; padding: 0 0 60px 0; position: relative;
      z-index: 2;
    }
    .main-title { font-size:2.1rem; font-weight:900; margin:56px 0 32px 0; text-align: center;}
    .filter-buttons, .category-buttons {
      display: flex; justify-content: center; gap: 12px;
    }
    .filter-buttons { margin-bottom: 16px; }
    .category-buttons { margin-bottom: 34px; }
    .filter-buttons button, .category-buttons button {
      background: #fff; color:#e60012; border: 2px solid #e60012;
      padding:7px 22px; border-radius:22px; font-size: 1.08rem;
      font-weight:700; cursor:pointer; transition:.18s;
      display: flex; align-items: center; gap: 7px;
    }
    .filter-buttons button.active, .filter-buttons button:hover,
    .category-buttons button.active, .category-buttons button:hover {
      background: #e60012; color: #fff;
    }
    /* 비교 타이틀 */
    .compare-title {
      font-size: 1.5rem;
      font-weight: bold;
      text-align: center;
      color: #18355f;
      margin: 36px 0 10px 0;
      letter-spacing: 0.03em;
      display: none;
    }
    .compare-title.active { display: block; }

    /* 비교하기 영역 */
    #compareArea {
      position: relative; display: none; background: #f5faff;
      border-radius: 22px;
      box-shadow: 0 4px 24px 0 rgba(33,45,73,0.11);
      border: 2.5px solid #c9e1f7;
      max-width: 1100px;
      margin: 0 auto 32px auto; padding: 38px 26px 16px 26px;
      min-height: 90px; overflow-x: auto; z-index: 5;
      transition: background 0.25s, border 0.25s;
    }
    #compareArea.active { display: block;}
    .close-compare { position: absolute; top: 10px; right: 24px;
      background: none; border: none; font-size: 1.6rem;
      cursor: pointer; color: #888; z-index: 10; line-height: 1; font-weight: 900; padding: 2px;
      transition: color 0.19s;}
    .close-compare:hover { color: #e60012; background: #f8eaea;}
    table.compare-table { width: 100%; min-width: 600px; max-width: 900px; margin: 0 auto; border-collapse: separate; border-spacing: 0;
      background: #fff; border-radius: 18px; box-shadow: none; overflow: visible; margin-bottom: 14px; table-layout: fixed;}
    table.compare-table th, table.compare-table td {
      border: 1px solid #b4bfd7; padding: 12px 7px; text-align: center;
      background: #fff; white-space: pre-line; line-height: 1.6; font-size: 1em; vertical-align: middle;
      min-width: 80px; transition: background 0.22s;
    }
    table.compare-table th {
      background: #eaf2fb;
      color: #19315e;
      font-weight: 800;
      letter-spacing: 0.01em;
    }
    table.compare-table th:first-child, table.compare-table td:first-child {
      width: 120px !important; min-width: 120px !important; max-width: 120px !important;
      background: #eef6fb; text-align: center;
    }
    table.compare-table td:nth-child(3) { background: #f8fbff !important; }
    .compare-product-header {
      font-weight: bold;
      font-size: 1.09rem;
      letter-spacing: 0.01em;
      color: #47649c;
      padding-bottom: 5px;
    }
    .compare-limit-msg { color: #e60012; font-size: 1.09rem; margin: 10px auto 0 auto; text-align: center; font-weight: 700; background: none;}
    /* 카드영역 */
    .product-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 38px 28px;
      min-height: 355px;
      width:100%;
      margin: 0 auto;
    }
    @media (max-width: 1200px) {
      .container-main { width:97vw;}
      .side-banner-fixed { display: none !important;}
    }
    @media (max-width: 900px) {
      .product-grid { grid-template-columns:repeat(2,1fr);}
    }
    @media (max-width: 650px) {
      .product-grid { grid-template-columns:1fr;}
    }
    .product-card {
      position: relative; border: 1.5px solid #eee; border-radius: 18px;
      overflow: hidden; background: #fff;
      box-shadow: 0 4px 14px rgba(0,0,0,0.08);
      min-height:355px; width:100%;
      display: flex; flex-direction:column; justify-content: flex-start;
      transition: transform 0.23s, box-shadow 0.23s, border 0.25s;
      max-width:340px; margin:0 auto;
      outline: none;
    }
    .product-card.selected {
      border: 2.2px solid #e60012 !important;
      box-shadow: 0 0 0 4px #fde4e9;
      animation: shineBorder 0.55s;
      background: linear-gradient(135deg, #fff 65%, #ffe4ea 100%);
    }
    @keyframes shineBorder {
      0% { box-shadow: 0 0 0 0 #fde4e9; }
      40% { box-shadow: 0 0 0 8px #fde4e9; }
      100% { box-shadow: 0 0 0 4px #fde4e9; }
    }
    .product-card:focus { box-shadow:0 0 0 3px #e60012,0 4px 14px rgba(0,0,0,0.10);}
    .product-card:hover { transform:translateY(-7px); box-shadow:0 10px 28px 0 rgba(33,45,73,0.13);}
    .product-img-wrapper {position: relative; width:100%; height:178px; overflow:hidden; background:#f8f9fa;}
    .product-img {width: 100%; height: 100%; object-fit: cover; display: block;}
    .card-hover-overlay {
      position:absolute;top:0;left:0;right:0;bottom:0;
      background:rgba(0,0,0,0.63);color:#fff;font-size:1.05rem;
      text-align:center;opacity:0;transition:opacity .33s cubic-bezier(.43,.44,.55,1.05);
      pointer-events:none;z-index:4;display:flex;align-items:center;justify-content:center;
      padding:0 16px;line-height:1.7;word-break:keep-all;
    }
    .product-card:hover .card-hover-overlay,
    .product-card:focus .card-hover-overlay.card-tts-on {opacity:1;pointer-events:auto;}
    .badge {position: absolute; top: 13px; left: 13px; background: #fff; border: 1px solid #e60012; color: #e60012; font-weight: 700; font-size: 0.85rem; padding: 5px 13px; border-radius: 14px; z-index: 3;}
    .compare-checkbox {
      -webkit-appearance: none; appearance: none;
      width: 30px; height: 30px; border: 2.2px solid #e60012;
      border-radius: 50%; position: absolute; top: 14px; right: 15px;
      background: #fff; color: #e60012; font-size: 20px; font-weight: 900;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; z-index: 10; box-shadow: 0 1px 7px 0 rgba(230,0,18,0.10);
      transition: background 0.23s, color 0.23s, border-color 0.18s;
      text-align: center;
    }
    .compare-checkbox::before { content: "+"; display: block; transition: color 0.22s;}
    .compare-checkbox:checked {background-color: #e60012; color: #fff; border-color: #e60012;}
    .compare-checkbox:checked::before { content: "✓"; color: #fff;}
    .compare-checkbox:disabled { opacity: 0.4; cursor: not-allowed;}
    .compare-checkbox.animated {
      animation: popCheckbox 0.45s cubic-bezier(.4,2,.5,.97);
      box-shadow: 0 0 0 5px #ffe4e6;
    }
    @keyframes popCheckbox {
      0% { transform: scale(1);}
      30% { transform: scale(1.3); background: #feecec;}
      70% { transform: scale(0.9);}
      100% { transform: scale(1);}
    }
    .product-info {
      padding: 23px 10px 8px 10px; background: #fff; text-align: center; flex:1 1 auto;
      display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
    }
    .product-name {
      font-weight: 900; font-size: 1.27rem; margin-bottom: 9px; color: #212d49;
      display: flex; justify-content: center; align-items: center; gap: 7px; line-height: 1.25;
    }
    .product-tags {margin-bottom: 8px;}
    .product-tags span {display: inline-block; font-size: 0.93rem; margin: 0 5px 5px 0; color: #5b5c5f; background: #f4f5fa; border-radius: 8px; padding: 3px 11px; font-weight: 600;}
    .shield-icon {margin-left:4px;}
    .product-currency {
      min-height: 48px; margin-top: 6px; margin-bottom: 4px; font-size: 1.18rem; font-weight: 900;
      color: #e60012; letter-spacing: 0.01em; line-height: 1.22; white-space: pre-line;
    }
    /* ---- 오른쪽 고정 배너 ---- */
    .side-banner-fixed {
      position: absolute;
      left: 53%;
      margin-left: 465px;
      width: 190px;
      min-width: 140px;
      z-index: 99;
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 3px 12px 0 rgba(33,45,73,0.09);
      padding: 20px 10px 8px 10px;
      display: flex; flex-direction: column;
      align-items: center;
      text-align: center;
      transition: left 0.2s, top 0.2s;
    }
    .side-banner-title {
      font-size: 1.2em; font-weight: 900;
      margin-bottom: 15px; color: #212d49;
    }
    .side-banner-currency-list {
      display: flex; flex-direction: column; gap: 10px; width: 100%; align-items: center; margin-bottom: 7px;
    }
    .side-banner-currency-list label {
      width: 100%;
      background: #f7f8fb;
      border-radius: 10px;
      padding: 4px 0;
      margin: 0 auto;
      display: flex; align-items: center; justify-content: center;
      font-size: 0.93em; font-weight: 700; color: #212d49;
      border: 1px solid #e7e7e7;
      transition: background 0.17s;
      cursor: pointer;
    }
    .side-banner-currency-list label:hover, .side-banner-currency-list input:checked+label {
      background: #feecec;
      color: #e60012;
      border-color: #e60012;
    }
    .side-banner-currency-list input[type="checkbox"] {
      accent-color: #e60012;
      width: 15px; height: 15px;
      margin-right: 6px;
      vertical-align: middle;
    }
    .side-banner-notice {
      font-size: 0.82em;
      color: #969fb7;
      margin-top: 2px;
      margin-bottom: 6px;
      text-align: center;
    }
    .compare-main-btn {
      width:100%; font-size:0.97rem; background:#000; color:#fff; font-weight:900;
      margin:7px 0 20px 0; padding: 7px 0;
      border-radius: 8px; border:none; cursor:pointer; letter-spacing: 0.02em;
      display: block; box-shadow:0 2px 8px 0 rgba(0,0,0,0.08); transition: background 0.14s, transform 0.12s; text-align:center;
    }
    .compare-main-btn:active, .compare-main-btn:hover {background:#e60012;color:#fff;transform:scale(1.04);}
    /* -------- 토글버튼 (접근성) -------- */
    .accessibility-controls {
      position: fixed;
      top: 46%; right: 54px;
      transform: translateY(-50%);
      display: flex; flex-direction: column; gap: 13px;
      z-index: 2000; background: none;
    }
    .accessibility-controls button {
      padding: 10px 0; width: 44px; border: none; border-radius: 50%;
      background-color: #000000; color: #fff; font-size: 1.12rem;
      cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.09);
      transition: background 0.2s, color 0.2s;
      margin-bottom: 0;
      position: relative;
      outline: none;
      display: flex; align-items: center; justify-content: center;
    }
    .accessibility-controls button:hover { background-color: #e60012; }
    .accessibility-tooltip {
      visibility: hidden; opacity: 0;
      position: absolute; right: 110%; top: 50%;
      transform: translateY(-50%);
      background: #000000;
      color: #fff;
      font-size: 0.95rem;
      padding: 7px 14px;
      border-radius: 10px;
      white-space: nowrap;
      z-index: 10;
      box-shadow: 0 2px 14px 0 rgba(25,60,120,0.10);
      pointer-events: none;
      transition: opacity 0.3s, visibility 0.3s;
      font-weight: 500;
      letter-spacing: 0.01em;
      left: auto;
    }
    .accessibility-controls button:hover .accessibility-tooltip,
    .accessibility-controls button:focus .accessibility-tooltip {
      visibility: visible; opacity: 1;
      animation: tooltip-pop 0.32s;
    }
    @keyframes tooltip-pop {
      0% { opacity: 0; transform: translateY(-50%) scale(0.8);}
      100% { opacity: 1; transform: translateY(-50%) scale(1);}
    }
    .accessibility-tooltip::after {
      content: '';
      position: absolute;
      left: 100%; top: 50%;
      margin-top: -7px;
      border-width: 7px;
      border-style: solid;
      border-color: transparent transparent transparent #212d49;
    }
    /* 다크모드 - 비교표와 선택 강조색 */
    body.dark-mode { background:#1d202a; color:#e6e6e6;}
    body.dark-mode .container-main { color: #fff;}
    body.dark-mode .product-card { background: #2a2e3c; color: #eee; border-color: #3e4763;}
    body.dark-mode .product-card.selected { background: linear-gradient(135deg,#222741 65%,#402a3d 100%);}
    body.dark-mode .product-info { background: #2a2e3c;}
    body.dark-mode .side-banner-fixed {background: #222742; color: #fff;}
    body.dark-mode .side-banner-title {color:#ffe4e4;}
    body.dark-mode .side-banner-currency-list label { background:#27314c; color: #fff; border-color: #334;}
    body.dark-mode .side-banner-currency-list label:hover, body.dark-mode .side-banner-currency-list input:checked+label { background:#e60012; color:#fff; border-color:#e60012;}
    body.dark-mode .compare-main-btn { background:#fff; color:#e60012;}
    body.dark-mode .product-name {color: #fff;}
    body.dark-mode .compare-title {color:#ffe5e5;}
    body.dark-mode table.compare-table th, 
    body.dark-mode table.compare-table td { background:#232a3a !important; color:#fff !important; border-color: #556080;}
    body.dark-mode table.compare-table th:first-child,
    body.dark-mode table.compare-table td:first-child {background:#2c3142 !important; color: #fff;}
    body.dark-mode .compare-product-header {color:#ffe5e5;}
  </style>
</head>
<body>
  <div th:replace="~{fragments/header2 :: header}"></div>
  <!-- 오른쪽 토글버튼 메뉴 -->
  <div class="accessibility-controls">
    <button onclick="decreaseFontSize()" title="글자 축소"><span aria-hidden="true">A−</span><span class="accessibility-tooltip">글자 축소</span></button>
    <button onclick="increaseFontSize()" title="글자 확대"><span aria-hidden="true">A+</span><span class="accessibility-tooltip">글자 확대</span></button>
    <button id="ttsBtn" onclick="toggleTTS()" title="텍스트 읽기"><span aria-hidden="true">🔊</span><span class="accessibility-tooltip">전체 안내</span></button>
    <button id="soundModeBtn" onclick="toggleSoundMode()" title="상품 소리안내"><span aria-hidden="true" id="soundModeIcon">🔈</span><span class="accessibility-tooltip">상품별 안내</span></button>
    <button id="keyboardModeBtn" onclick="toggleKeyboardMode()" title="키보드 모드">
      <span aria-hidden="true" id="keyboardModeIcon">⌨️</span>
      <span class="accessibility-tooltip">키보드모드</span>
    </button>
    <button id="darkModeBtn" onclick="toggleDarkMode()" title="다크/고대비">
      <span id="darkModeIcon" aria-hidden="true">🌙</span>
      <span class="accessibility-tooltip">다크모드</span>
    </button>
  </div>
  <div class="container-main">
    <div class="main-title">BNK 외화예금 상품입니다.</div>
    <div class="filter-buttons">
      <button class="active" data-type="all">전체</button>
      <button data-type="정기예금">정기예금</button>
      <button data-type="적금">적금</button>
      <button data-type="입출금예금">입출금</button>
      <button data-type="복합형">복합형</button>
    </div>
    <div class="category-buttons">
      <button data-cat="study">🎓 유학</button>
      <button data-cat="immigration">🛂 이민</button>
      <button data-cat="travel">✈️ 여행</button>
      <button data-cat="investment">💹 투자</button>
    </div>
    <!-- 비교 타이틀 -->
    <div id="compareTitle" class="compare-title">상품 비교</div>
    <!-- 비교하기 영역 -->
    <div id="compareArea">
      <button class="close-compare" onclick="clearCompare()" title="비교 닫기">&times;</button>
      <table class="compare-table" id="compareTable"></table>
      <div id="compareLimitMsg" class="compare-limit-msg" style="display:none;">상품 비교는 최대 3개까지만 가능합니다.</div>
    </div>
    <div class="product-grid" id="productGrid"></div>
  </div>
  <!-- 오른쪽 고정 광고/필터/비교 배너 -->
  <div class="side-banner-fixed" id="sideBanner">
    <div class="side-banner-title">가입할 통화를<br>선택하세요.</div>
    <div class="side-banner-currency-list" id="currencyList">
      <label><input type="checkbox" value="USD"> <b>미국달러화(USD)</b></label>
      <label><input type="checkbox" value="JPY"> <b>일본엔화(JPY)</b></label>
      <label><input type="checkbox" value="EUR"> <b>유로화(EUR)</b></label>
      <label><input type="checkbox" value="AUD"> <b>호주달러화(AUD)</b></label>
      <label><input type="checkbox" value="GBP"> <b>영국파운드화(GBP)</b></label>
      <label><input type="checkbox" value="CHF"> <b>스위스프랑화(CHF)</b></label>
      <label><input type="checkbox" value="CAD"> <b>캐나다달러화(CAD)</b></label>
      <label><input type="checkbox" value="CNY"> <b>중국위안화(CNY)</b></label>
    </div>
    <div class="side-banner-notice">
      * 그 외 통화는 영업점<br>개별 문의 바랍니다.
    </div>
    <button class="compare-main-btn" id="mainCompareBtn" style="margin-top:10px;">+ 상품 비교하기</button>
  </div>
  <div th:replace="fragments/dictionary-button :: dictionary-button"></div>
  <div th:replace="~{fragments/footer :: footer}"></div>
  
  <script>
    // 상품 데이터
    const products = [
      {  pno: "P001", name: "꿈이룸 외화자유적금", type: "적금", description: "외화 자동이체로\n목돈 마련을 시작하세요!", tags: ["#자동이체", "#목돈 마련"], currencies: ["USD"], join: ["영업점 가입"], categories: ["study"], img: "img/main/m1.png" },
      {  pno: "P002", name: "BNK모아드림외화적금", type: "적금", description: "짧은 기간에도\n꾸준히 외화를 모으세요.", tags: ["#환테크", "#단기저축"], currencies: ["USD", "EUR", "JPY", "AUD"], join: ["영업점 가입"], categories: ["study"], img: "img/main/m5.png" },
      {  pno: "P003", name: "BNK UP & UP 외화정기예금", type: "정기예금", description: "예치기간이 늘수록\n금리도 UP!", tags: ["#정기예금", "#금리상승"], currencies: ["USD", "JPY", "EUR"], join: ["영업점 가입"], categories: ["investment"], img: "img/main/m4.png" },
      {  pno: "P004", name: "업앤업 외화MMDA", type: "입출금예금", description: "하루만 맡겨도\n이자가 쌓여요.", tags: ["#입출금", "#유동성"], currencies: ["USD", "JPY", "EUR"], join: ["영업점 가입"], categories: ["travel"], img: "img/main/m2.png" },
      {  pno: "P006", name: "외화정기예금", type: "정기예금", description: "최고 금리, 장기 예치에 적합!", tags: ["#장기예치", "#최고금리"], currencies: ["USD", "JPY", "GBP", "CHF", "EUR", "AUD", "CAD"], join: ["영업점 가입", "인터넷 가입"], categories: ["investment"], img: "img/main/m6.png" },
      {  pno: "P008", name: "외화보통예금", type: "입출금예금", description: "외화를 자주\n입출금하는 고객을 위해!", tags: ["#자유입출금", "#개인맞춤"], currencies: ["USD", "JPY", "EUR", "GBP", "CHF", "CAD", "AUD", "CNY"], join: ["영업점 가입"], categories: ["immigration"], img: "img/main/m8.png" },
      {  pno: "P005", name: "EASY 환테크 듀얼통장", type: "복합형", description: "환율 걱정 없이\n자동환전/매매까지!", tags: ["#환테크", "#자동매매"], currencies: ["USD"], join: ["영업점 가입"], categories: ["travel"], img: "img/main/m3.png" },
      {  pno: "P007", name: "외화당좌예금", type: "적금", description: "원하는 기간에 맞춰\n차곡차곡 목돈 준비!", tags: ["#목돈모으기", "#정기적금"], currencies: ["USD"], join: ["영업점 가입"], categories: ["investment"], img: "img/main/m7.png" }
    ];

    // 접근성/상태 변수
    let currentFontSize = 16;
    let soundMode = false;
    let keyboardMode = false;
    let isSpeaking = false;
    let ttsUtter;

    // 현재 필터
    let selectedType = 'all';
    let selectedCategory = '';
    let selectedCurrencies = ['USD'];

    // 비교함 상태
    let compareList = [];
    let cardElements = [];
    let cardFocusIdx = 0;

    // 통화선택 체크박스 이벤트 연결
    document.addEventListener('DOMContentLoaded', function() {
      document.querySelectorAll('.side-banner-currency-list input[type="checkbox"]').forEach(cb => {
        cb.addEventListener('change', function() {
          selectedCurrencies = Array.from(document.querySelectorAll('.side-banner-currency-list input[type="checkbox"]:checked')).map(x=>x.value);
          renderProducts();
        });
      });

      document.querySelectorAll('.filter-buttons button').forEach(btn=>{
        btn.addEventListener('click', function(){
          document.querySelectorAll('.filter-buttons button').forEach(b=>b.classList.remove('active'));
          this.classList.add('active');
          selectedType = this.getAttribute('data-type');
          renderProducts();
        });
      });
      document.querySelectorAll('.category-buttons button').forEach(btn=>{
        btn.addEventListener('click', function(){
          document.querySelectorAll('.category-buttons button').forEach(b=>b.classList.remove('active'));
          if(selectedCategory===this.getAttribute('data-cat')) {
            selectedCategory='';
          } else {
            selectedCategory = this.getAttribute('data-cat');
            this.classList.add('active');
          }
          renderProducts();
        });
      });

      document.getElementById('mainCompareBtn').onclick = function() {
        if(compareList.length>0) {
          showCompareArea();
        }
        animateAllCheckboxes();
      };

      renderProducts();
      updateCompareArea();
      updateDarkModeIcon();
      adjustSideBannerPosition();
    });

    function renderProducts() {
      const grid = document.getElementById('productGrid');
      grid.innerHTML = '';
      let list = products.filter((p, idx) => {
        let okType = (selectedType==='all'||p.type===selectedType);
        let okCat = (!selectedCategory||p.categories.includes(selectedCategory));
        let okCur = (selectedCurrencies.length===0||p.currencies.some(c=>selectedCurrencies.includes(c)));
        return okType && okCat && okCur;
      });
      cardElements = [];
      list.forEach((p, idx)=>{
        const card = document.createElement('div');
        let checked = compareList.findIndex(x=>x.name===p.name)!==-1;
        card.className = 'product-card'+(checked?' selected':'');
        card.tabIndex = 0;
        // 카드 본문
        card.innerHTML = `
          <div class="product-img-wrapper">
            <img src="${p.img}" class="product-img" alt="${p.name}">
            <div class="card-hover-overlay">${p.description.replace(/\n/g,'<br>')}</div>
            <span class="badge">${p.join[0]}</span>
            <input type="checkbox" class="compare-checkbox${checked ? ' animated' : ''}" title="비교함에 추가" ${checked?'checked':''} tabindex="0">
          </div>
          <div class="product-info">
            <div class="product-name">${p.name} <span class="shield-icon" title="예금자보호 대상">🛡️</span></div>
            <div class="product-tags">${p.tags.map(t=>`<span>${t}</span>`).join('')}</div>
            <div class="product-currency">${formatCurrencyList(p.currencies)}</div>
          </div>
        `;
        /* ① 신규 추가: 카드 클릭 시 상세 페이지로 이동 */
        card.addEventListener('click', e => {
          // 비교 체크박스를 누를 때는 이동하지 않음
          if (e.target.classList.contains('compare-checkbox')) return;
          window.location.href = `/productDetail?pno=${encodeURIComponent(p.pno)}`;
        });
        // 비교함 +버튼 기능/애니메이션
        let cb = card.querySelector('.compare-checkbox');
        cb.addEventListener('click', function(e) {
          e.stopPropagation();
          if(cb.checked) {
            // 최대 3개 제한
            if(compareList.length>=3) {
              cb.checked = false;
              showCompareLimitMsg();
              return;
            }
            // 애니메이션 효과
            cb.classList.remove('animated'); void cb.offsetWidth; cb.classList.add('animated');
            compareList.push(p);
          } else {
            compareList = compareList.filter(x=>x.name!==p.name);
          }
          updateCompareArea();
        });
        // 소리 안내(접근성)
        card.addEventListener('mouseenter', function(){
          if(soundMode) playCardTTS(p.name, p.description.replace(/\n/g, ', '));
        });
        card.addEventListener('mouseleave', function(){
          if(soundMode) stopTTS();
        });
        // 키보드 모드시 포커스/Space 키 선택
        card.addEventListener('focus', function(){
          if(keyboardMode) {
            this.querySelector('.card-hover-overlay').classList.add('card-tts-on');
            if(soundMode) playCardTTS(p.name, p.description.replace(/\n/g, ', '));
          }
        });
        card.addEventListener('blur', function(){
          if(keyboardMode) {
            this.querySelector('.card-hover-overlay').classList.remove('card-tts-on');
            stopTTS();
          }
        });
        cardElements.push(card);
        grid.appendChild(card);
      });
      if(keyboardMode && cardElements.length>0) {
        cardElements[0].focus();
      }
      adjustSideBannerPosition();
    }

    // 모든 카드의 체크박스에 애니메이션 효과
    function animateAllCheckboxes() {
    	document.querySelectorAll('.compare-checkbox').forEach(cb => {
    	      cb.classList.remove('animated');
    	      void cb.offsetWidth; // 리플로우로 애니메이션 다시 적용
    	      cb.classList.add('animated');
    	    });
    }

    // 통화 줄바꿈 (4개 이하 한줄, 이상은 줄바꿈)
    function formatCurrencyList(curArr) {
      if(!curArr || curArr.length===0) return '';
      let arr = curArr.map(c=>c.toUpperCase());
      if(arr.length<=4) return `<span style="color:#e60012;">${arr.join(', ')}</span>`;
      return `<span style="color:#e60012;">${arr.slice(0,4).join(', ')}<br>${arr.slice(4).join(', ')}</span>`;
    }

    // 비교 영역 표시/비활성화 & 타이틀
    function showCompareArea() {
      document.getElementById('compareArea').classList.add('active');
      document.getElementById('compareTitle').classList.add('active');
      renderCompareTable();
    }
    function updateCompareArea() {
      const area = document.getElementById('compareArea');
      const title = document.getElementById('compareTitle');
      if(compareList.length===0) {
        area.classList.remove('active');
        title.classList.remove('active');
      } else {
        area.classList.add('active');
        title.classList.add('active');
        renderCompareTable();
      }
      renderProducts(); // 테두리 반영
    }
    function clearCompare() {
      compareList = [];
      updateCompareArea();
      renderProducts();
    }
    function showCompareLimitMsg() {
      const msg = document.getElementById('compareLimitMsg');
      msg.style.display = 'block';
      setTimeout(()=>{ msg.style.display='none'; }, 1800);
    }
    function renderCompareTable() {
      const table = document.getElementById('compareTable');
      if(compareList.length===0) { table.innerHTML=''; return; }
      let productNumberHeader = `
        <tr>
          <th></th>
          ${compareList.map((_,i)=>`<td><div class="compare-product-header">상품${i+1}</div></td>`).join('')}
        </tr>
      `;
      table.innerHTML = `
        ${productNumberHeader}
        <tr>
          <th>상품명</th>
          ${compareList.map(p=>`<td>${p.name}</td>`).join('')}
        </tr>
        <tr>
          <th>주요 특징</th>
          ${compareList.map(p=>`<td>${p.description.replace(/\n/g,'<br>')}</td>`).join('')}
        </tr>
        <tr>
          <th>가입방법</th>
          ${compareList.map(p=>`<td>${p.join.join('<br>')}</td>`).join('')}
        </tr>
        <tr>
          <th>통화</th>
          ${compareList.map(p=>`<td>${formatCurrencyList(p.currencies)}</td>`).join('')}
        </tr>
      `;
    }

    // 상품 개별 TTS
    function playCardTTS(name, desc) {
      stopTTS();
      ttsUtter = new SpeechSynthesisUtterance(`${name}. ${desc}`);
      ttsUtter.lang = 'ko-KR';
      speechSynthesis.speak(ttsUtter);
      isSpeaking = true;
    }
    function stopTTS() {
      if(isSpeaking) {
        speechSynthesis.cancel();
        isSpeaking = false;
      }
    }

    // 접근성 토글
    function increaseFontSize() {
      if(currentFontSize < 24) currentFontSize++;
      document.documentElement.style.fontSize = currentFontSize + 'px';
    }
    function decreaseFontSize() {
      if(currentFontSize > 12) currentFontSize--;
      document.documentElement.style.fontSize = currentFontSize + 'px';
    }
    function toggleTTS() {
      if(isSpeaking) {
        speechSynthesis.cancel();
        isSpeaking = false;
        document.getElementById('ttsBtn').querySelector('span[aria-hidden]').textContent = '🔊';
      } else {
        const text = document.querySelector('.container-main').innerText;
        ttsUtter = new SpeechSynthesisUtterance(text);
        ttsUtter.lang = 'ko-KR';
        ttsUtter.onend = () => {
          isSpeaking = false;
          document.getElementById('ttsBtn').querySelector('span[aria-hidden]').textContent = '🔊';
        };
        speechSynthesis.speak(ttsUtter);
        isSpeaking = true;
        document.getElementById('ttsBtn').querySelector('span[aria-hidden]').textContent = '⏹️';
      }
    }
    function toggleSoundMode() {
      soundMode = !soundMode;
      document.getElementById('soundModeIcon').textContent = soundMode ? '🔊' : '🔈';
      if (!soundMode) stopTTS();
    }
    function toggleKeyboardMode() {
      keyboardMode = !keyboardMode;
      document.getElementById('keyboardModeIcon').textContent = keyboardMode ? '⏹️' : '⌨️';
      if(keyboardMode && cardElements.length>0) {
        cardFocusIdx = 0;
        cardElements[0].focus();
      }
    }
    function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
      updateDarkModeIcon();
    }
    function updateDarkModeIcon() {
      const icon = document.getElementById('darkModeIcon');
      if (document.body.classList.contains('dark-mode')) {
        icon.textContent = '☀️';
      } else {
        icon.textContent = '🌙';
      }
    }

    // 키보드 화살표/탭/엔터 이벤트 (키보드 모드 활성화 시)
    document.addEventListener('keydown', function(e){
      if(!keyboardMode || cardElements.length===0) return;
      if(document.activeElement.classList.contains('product-card')) {
        if(e.key==="ArrowRight"||e.key==="ArrowDown") {
          cardFocusIdx = (cardFocusIdx+1)%cardElements.length;
          cardElements[cardFocusIdx].focus();
          e.preventDefault();
        }
        if(e.key==="ArrowLeft"||e.key==="ArrowUp") {
          cardFocusIdx = (cardFocusIdx-1+cardElements.length)%cardElements.length;
          cardElements[cardFocusIdx].focus();
          e.preventDefault();
        }
      }
    });

    // 광고 배너 위치 조정
    function adjustSideBannerPosition() {
      const grid = document.querySelector('.product-grid');
      const banner = document.getElementById('sideBanner');
      if (grid && banner) {
        const rect = grid.getBoundingClientRect();
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        const top = rect.top + scrollTop;
        banner.style.top = top + 'px';
      }
    }
    window.addEventListener('resize', adjustSideBannerPosition);
    window.addEventListener('scroll', adjustSideBannerPosition);
    document.addEventListener('DOMContentLoaded', () => {
        fetch('/product/names')
          .then(res => res.json())
          .then(names => {
            // products는 이미 선언되어 있음 (하드코딩 데이터)
            const filtered = products.filter(p => names.includes(p.name));
            products.length = 0; // 기존 배열 비우기
            filtered.forEach(p => products.push(p)); // 활성화 상품만 다시 채우기
            renderProducts(); // 상품 다시 렌더링
          })
          .catch(err => {
            console.error("상품명 불러오기 실패:", err);
          });
      });
  </script>
</body>
</html>
