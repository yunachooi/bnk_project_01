<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>BNK ì™¸í™”ì˜ˆê¸ˆ</title>
  <link rel="stylesheet" th:href="@{/css/common.css}" />
  <link rel="stylesheet" th:href="@{/css/dictionary-button.css}" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap">
  <style>
    * { box-sizing: border-box; }
    html, body { height:100%; }
    body {
      margin:0; font-family:'Noto Sans KR',sans-serif; color:#212d49; background:#fff;
      transition: background 0.3s, color 0.3s;
    }
    .container-main {
      width: 1000px; max-width: 98vw;
      margin: 0 auto; padding: 0 0 60px 0; position: relative;
      z-index: 2;
    }
    .main-title { font-size:2.1rem; font-weight:900; margin:56px 0 32px 0; text-align: center;}
    .filter-buttons, .category-buttons {
      display: flex; justify-content: center; gap: 12px;
    }
    .filter-buttons { margin-bottom: 16px; }
    .category-buttons { margin-bottom: 34px; }
    .filter-buttons button, .category-buttons button {
      background: #fff; color:#e60012; border: 2px solid #e60012;
      padding:7px 22px; border-radius:22px; font-size: 1.08rem;
      font-weight:700; cursor:pointer; transition:.18s;
      display: flex; align-items: center; gap: 7px;
    }
    .filter-buttons button.active, .filter-buttons button:hover,
    .category-buttons button.active, .category-buttons button:hover {
      background: #e60012; color: #fff;
    }
    /* ë¹„êµ íƒ€ì´í‹€ */
    .compare-title {
      font-size: 1.5rem;
      font-weight: bold;
      text-align: center;
      color: #18355f;
      margin: 36px 0 10px 0;
      letter-spacing: 0.03em;
      display: none;
    }
    .compare-title.active { display: block; }

    /* ë¹„êµí•˜ê¸° ì˜ì—­ */
    #compareArea {
      position: relative; display: none; background: #f5faff;
      border-radius: 22px;
      box-shadow: 0 4px 24px 0 rgba(33,45,73,0.11);
      border: 2.5px solid #c9e1f7;
      max-width: 1100px;
      margin: 0 auto 32px auto; padding: 38px 26px 16px 26px;
      min-height: 90px; overflow-x: auto; z-index: 5;
      transition: background 0.25s, border 0.25s;
    }
    #compareArea.active { display: block;}
    .close-compare { position: absolute; top: 10px; right: 24px;
      background: none; border: none; font-size: 1.6rem;
      cursor: pointer; color: #888; z-index: 10; line-height: 1; font-weight: 900; padding: 2px;
      transition: color 0.19s;}
    .close-compare:hover { color: #e60012; background: #f8eaea;}
    table.compare-table { width: 100%; min-width: 600px; max-width: 900px; margin: 0 auto; border-collapse: separate; border-spacing: 0;
      background: #fff; border-radius: 18px; box-shadow: none; overflow: visible; margin-bottom: 14px; table-layout: fixed;}
    table.compare-table th, table.compare-table td {
      border: 1px solid #b4bfd7; padding: 12px 7px; text-align: center;
      background: #fff; white-space: pre-line; line-height: 1.6; font-size: 1em; vertical-align: middle;
      min-width: 80px; transition: background 0.22s;
    }
    table.compare-table th {
      background: #eaf2fb;
      color: #19315e;
      font-weight: 800;
      letter-spacing: 0.01em;
    }
    table.compare-table th:first-child, table.compare-table td:first-child {
      width: 120px !important; min-width: 120px !important; max-width: 120px !important;
      background: #eef6fb; text-align: center;
    }
    table.compare-table td:nth-child(3) { background: #f8fbff !important; }
    .compare-product-header {
      font-weight: bold;
      font-size: 1.09rem;
      letter-spacing: 0.01em;
      color: #47649c;
      padding-bottom: 5px;
    }
    .compare-limit-msg { color: #e60012; font-size: 1.09rem; margin: 10px auto 0 auto; text-align: center; font-weight: 700; background: none;}
    /* ì¹´ë“œì˜ì—­ */
    .product-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 38px 28px;
      min-height: 355px;
      width:100%;
      margin: 0 auto;
    }
    @media (max-width: 1200px) {
      .container-main { width:97vw;}
      .side-banner-fixed { display: none !important;}
    }
    @media (max-width: 900px) {
      .product-grid { grid-template-columns:repeat(2,1fr);}
    }
    @media (max-width: 650px) {
      .product-grid { grid-template-columns:1fr;}
    }
    .product-card {
      position: relative; border: 1.5px solid #eee; border-radius: 18px;
      overflow: hidden; background: #fff;
      box-shadow: 0 4px 14px rgba(0,0,0,0.08);
      min-height:355px; width:100%;
      display: flex; flex-direction:column; justify-content: flex-start;
      transition: transform 0.23s, box-shadow 0.23s, border 0.25s;
      max-width:340px; margin:0 auto;
      outline: none;
    }
    .product-card.selected {
      border: 2.2px solid #e60012 !important;
      box-shadow: 0 0 0 4px #fde4e9;
      animation: shineBorder 0.55s;
      background: linear-gradient(135deg, #fff 65%, #ffe4ea 100%);
    }
    @keyframes shineBorder {
      0% { box-shadow: 0 0 0 0 #fde4e9; }
      40% { box-shadow: 0 0 0 8px #fde4e9; }
      100% { box-shadow: 0 0 0 4px #fde4e9; }
    }
    .product-card:focus { box-shadow:0 0 0 3px #e60012,0 4px 14px rgba(0,0,0,0.10);}
    .product-card:hover { transform:translateY(-7px); box-shadow:0 10px 28px 0 rgba(33,45,73,0.13);}
    .product-img-wrapper {position: relative; width:100%; height:178px; overflow:hidden; background:#f8f9fa;}
    .product-img {width: 100%; height: 100%; object-fit: cover; display: block;}
    .card-hover-overlay {
      position:absolute;top:0;left:0;right:0;bottom:0;
      background:rgba(0,0,0,0.63);color:#fff;font-size:1.05rem;
      text-align:center;opacity:0;transition:opacity .33s cubic-bezier(.43,.44,.55,1.05);
      pointer-events:none;z-index:4;display:flex;align-items:center;justify-content:center;
      padding:0 16px;line-height:1.7;word-break:keep-all;
    }
    .product-card:hover .card-hover-overlay,
    .product-card:focus .card-hover-overlay.card-tts-on {opacity:1;pointer-events:auto;}
    .badge {position: absolute; top: 13px; left: 13px; background: #fff; border: 1px solid #e60012; color: #e60012; font-weight: 700; font-size: 0.85rem; padding: 5px 13px; border-radius: 14px; z-index: 3;}
    .compare-checkbox {
      -webkit-appearance: none; appearance: none;
      width: 30px; height: 30px; border: 2.2px solid #e60012;
      border-radius: 50%; position: absolute; top: 14px; right: 15px;
      background: #fff; color: #e60012; font-size: 20px; font-weight: 900;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; z-index: 10; box-shadow: 0 1px 7px 0 rgba(230,0,18,0.10);
      transition: background 0.23s, color 0.23s, border-color 0.18s;
      text-align: center;
    }
    .compare-checkbox::before { content: "+"; display: block; transition: color 0.22s;}
    .compare-checkbox:checked {background-color: #e60012; color: #fff; border-color: #e60012;}
    .compare-checkbox:checked::before { content: "âœ“"; color: #fff;}
    .compare-checkbox:disabled { opacity: 0.4; cursor: not-allowed;}
    .compare-checkbox.animated {
      animation: popCheckbox 0.45s cubic-bezier(.4,2,.5,.97);
      box-shadow: 0 0 0 5px #ffe4e6;
    }
    @keyframes popCheckbox {
      0% { transform: scale(1);}
      30% { transform: scale(1.3); background: #feecec;}
      70% { transform: scale(0.9);}
      100% { transform: scale(1);}
    }
    .product-info {
      padding: 23px 10px 8px 10px; background: #fff; text-align: center; flex:1 1 auto;
      display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
    }
    .product-name {
      font-weight: 900; font-size: 1.27rem; margin-bottom: 9px; color: #212d49;
      display: flex; justify-content: center; align-items: center; gap: 7px; line-height: 1.25;
    }
    .product-tags {margin-bottom: 8px;}
    .product-tags span {display: inline-block; font-size: 0.93rem; margin: 0 5px 5px 0; color: #5b5c5f; background: #f4f5fa; border-radius: 8px; padding: 3px 11px; font-weight: 600;}
    .shield-icon {margin-left:4px;}
    .product-currency {
      min-height: 48px; margin-top: 6px; margin-bottom: 4px; font-size: 1.18rem; font-weight: 900;
      color: #e60012; letter-spacing: 0.01em; line-height: 1.22; white-space: pre-line;
    }
    /* ---- ì˜¤ë¥¸ìª½ ê³ ì • ë°°ë„ˆ ---- */
    .side-banner-fixed {
      position: absolute;
      left: 53%;
      margin-left: 465px;
      width: 190px;
      min-width: 140px;
      z-index: 99;
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 3px 12px 0 rgba(33,45,73,0.09);
      padding: 20px 10px 8px 10px;
      display: flex; flex-direction: column;
      align-items: center;
      text-align: center;
      transition: left 0.2s, top 0.2s;
    }
    .side-banner-title {
      font-size: 1.2em; font-weight: 900;
      margin-bottom: 15px; color: #212d49;
    }
    .side-banner-currency-list {
      display: flex; flex-direction: column; gap: 10px; width: 100%; align-items: center; margin-bottom: 7px;
    }
    .side-banner-currency-list label {
      width: 100%;
      background: #f7f8fb;
      border-radius: 10px;
      padding: 4px 0;
      margin: 0 auto;
      display: flex; align-items: center; justify-content: center;
      font-size: 0.93em; font-weight: 700; color: #212d49;
      border: 1px solid #e7e7e7;
      transition: background 0.17s;
      cursor: pointer;
    }
    .side-banner-currency-list label:hover, .side-banner-currency-list input:checked+label {
      background: #feecec;
      color: #e60012;
      border-color: #e60012;
    }
    .side-banner-currency-list input[type="checkbox"] {
      accent-color: #e60012;
      width: 15px; height: 15px;
      margin-right: 6px;
      vertical-align: middle;
    }
    .side-banner-notice {
      font-size: 0.82em;
      color: #969fb7;
      margin-top: 2px;
      margin-bottom: 6px;
      text-align: center;
    }
    .compare-main-btn {
      width:100%; font-size:0.97rem; background:#000; color:#fff; font-weight:900;
      margin:7px 0 20px 0; padding: 7px 0;
      border-radius: 8px; border:none; cursor:pointer; letter-spacing: 0.02em;
      display: block; box-shadow:0 2px 8px 0 rgba(0,0,0,0.08); transition: background 0.14s, transform 0.12s; text-align:center;
    }
    .compare-main-btn:active, .compare-main-btn:hover {background:#e60012;color:#fff;transform:scale(1.04);}
    /* -------- í† ê¸€ë²„íŠ¼ (ì ‘ê·¼ì„±) -------- */
    .accessibility-controls {
      position: fixed;
      top: 46%; right: 54px;
      transform: translateY(-50%);
      display: flex; flex-direction: column; gap: 13px;
      z-index: 2000; background: none;
    }
    .accessibility-controls button {
      padding: 10px 0; width: 44px; border: none; border-radius: 50%;
      background-color: #000000; color: #fff; font-size: 1.12rem;
      cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.09);
      transition: background 0.2s, color 0.2s;
      margin-bottom: 0;
      position: relative;
      outline: none;
      display: flex; align-items: center; justify-content: center;
    }
    .accessibility-controls button:hover { background-color: #e60012; }
    .accessibility-tooltip {
      visibility: hidden; opacity: 0;
      position: absolute; right: 110%; top: 50%;
      transform: translateY(-50%);
      background: #000000;
      color: #fff;
      font-size: 0.95rem;
      padding: 7px 14px;
      border-radius: 10px;
      white-space: nowrap;
      z-index: 10;
      box-shadow: 0 2px 14px 0 rgba(25,60,120,0.10);
      pointer-events: none;
      transition: opacity 0.3s, visibility 0.3s;
      font-weight: 500;
      letter-spacing: 0.01em;
      left: auto;
    }
    .accessibility-controls button:hover .accessibility-tooltip,
    .accessibility-controls button:focus .accessibility-tooltip {
      visibility: visible; opacity: 1;
      animation: tooltip-pop 0.32s;
    }
    @keyframes tooltip-pop {
      0% { opacity: 0; transform: translateY(-50%) scale(0.8);}
      100% { opacity: 1; transform: translateY(-50%) scale(1);}
    }
    .accessibility-tooltip::after {
      content: '';
      position: absolute;
      left: 100%; top: 50%;
      margin-top: -7px;
      border-width: 7px;
      border-style: solid;
      border-color: transparent transparent transparent #212d49;
    }
    /* ë‹¤í¬ëª¨ë“œ - ë¹„êµí‘œì™€ ì„ íƒ ê°•ì¡°ìƒ‰ */
    body.dark-mode { background:#1d202a; color:#e6e6e6;}
    body.dark-mode .container-main { color: #fff;}
    body.dark-mode .product-card { background: #2a2e3c; color: #eee; border-color: #3e4763;}
    body.dark-mode .product-card.selected { background: linear-gradient(135deg,#222741 65%,#402a3d 100%);}
    body.dark-mode .product-info { background: #2a2e3c;}
    body.dark-mode .side-banner-fixed {background: #222742; color: #fff;}
    body.dark-mode .side-banner-title {color:#ffe4e4;}
    body.dark-mode .side-banner-currency-list label { background:#27314c; color: #fff; border-color: #334;}
    body.dark-mode .side-banner-currency-list label:hover, body.dark-mode .side-banner-currency-list input:checked+label { background:#e60012; color:#fff; border-color:#e60012;}
    body.dark-mode .compare-main-btn { background:#fff; color:#e60012;}
    body.dark-mode .product-name {color: #fff;}
    body.dark-mode .compare-title {color:#ffe5e5;}
    body.dark-mode table.compare-table th, 
    body.dark-mode table.compare-table td { background:#232a3a !important; color:#fff !important; border-color: #556080;}
    body.dark-mode table.compare-table th:first-child,
    body.dark-mode table.compare-table td:first-child {background:#2c3142 !important; color: #fff;}
    body.dark-mode .compare-product-header {color:#ffe5e5;}
  </style>
</head>
<body>
  <div th:replace="~{fragments/header2 :: header}"></div>
  <!-- ì˜¤ë¥¸ìª½ í† ê¸€ë²„íŠ¼ ë©”ë‰´ -->
  <div class="accessibility-controls">
    <button onclick="decreaseFontSize()" title="ê¸€ì ì¶•ì†Œ"><span aria-hidden="true">Aâˆ’</span><span class="accessibility-tooltip">ê¸€ì ì¶•ì†Œ</span></button>
    <button onclick="increaseFontSize()" title="ê¸€ì í™•ëŒ€"><span aria-hidden="true">A+</span><span class="accessibility-tooltip">ê¸€ì í™•ëŒ€</span></button>
    <button id="ttsBtn" onclick="toggleTTS()" title="í…ìŠ¤íŠ¸ ì½ê¸°"><span aria-hidden="true">ğŸ”Š</span><span class="accessibility-tooltip">ì „ì²´ ì•ˆë‚´</span></button>
    <button id="soundModeBtn" onclick="toggleSoundMode()" title="ìƒí’ˆ ì†Œë¦¬ì•ˆë‚´"><span aria-hidden="true" id="soundModeIcon">ğŸ”ˆ</span><span class="accessibility-tooltip">ìƒí’ˆë³„ ì•ˆë‚´</span></button>
    <button id="keyboardModeBtn" onclick="toggleKeyboardMode()" title="í‚¤ë³´ë“œ ëª¨ë“œ">
      <span aria-hidden="true" id="keyboardModeIcon">âŒ¨ï¸</span>
      <span class="accessibility-tooltip">í‚¤ë³´ë“œëª¨ë“œ</span>
    </button>
    <button id="darkModeBtn" onclick="toggleDarkMode()" title="ë‹¤í¬/ê³ ëŒ€ë¹„">
      <span id="darkModeIcon" aria-hidden="true">ğŸŒ™</span>
      <span class="accessibility-tooltip">ë‹¤í¬ëª¨ë“œ</span>
    </button>
  </div>
  <div class="container-main">
    <div class="main-title">BNK ì™¸í™”ì˜ˆê¸ˆ ìƒí’ˆì…ë‹ˆë‹¤.</div>
    <div class="filter-buttons">
      <button class="active" data-type="all">ì „ì²´</button>
      <button data-type="ì •ê¸°ì˜ˆê¸ˆ">ì •ê¸°ì˜ˆê¸ˆ</button>
      <button data-type="ì ê¸ˆ">ì ê¸ˆ</button>
      <button data-type="ì…ì¶œê¸ˆì˜ˆê¸ˆ">ì…ì¶œê¸ˆ</button>
      <button data-type="ë³µí•©í˜•">ë³µí•©í˜•</button>
    </div>
    <div class="category-buttons">
      <button data-cat="study">ğŸ“ ìœ í•™</button>
      <button data-cat="immigration">ğŸ›‚ ì´ë¯¼</button>
      <button data-cat="travel">âœˆï¸ ì—¬í–‰</button>
      <button data-cat="investment">ğŸ’¹ íˆ¬ì</button>
    </div>
    <!-- ë¹„êµ íƒ€ì´í‹€ -->
    <div id="compareTitle" class="compare-title">ìƒí’ˆ ë¹„êµ</div>
    <!-- ë¹„êµí•˜ê¸° ì˜ì—­ -->
    <div id="compareArea">
      <button class="close-compare" onclick="clearCompare()" title="ë¹„êµ ë‹«ê¸°">&times;</button>
      <table class="compare-table" id="compareTable"></table>
      <div id="compareLimitMsg" class="compare-limit-msg" style="display:none;">ìƒí’ˆ ë¹„êµëŠ” ìµœëŒ€ 3ê°œê¹Œì§€ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.</div>
    </div>
    <div class="product-grid" id="productGrid"></div>
  </div>
  <!-- ì˜¤ë¥¸ìª½ ê³ ì • ê´‘ê³ /í•„í„°/ë¹„êµ ë°°ë„ˆ -->
  <div class="side-banner-fixed" id="sideBanner">
    <div class="side-banner-title">ê°€ì…í•  í†µí™”ë¥¼<br>ì„ íƒí•˜ì„¸ìš”.</div>
    <div class="side-banner-currency-list" id="currencyList">
      <label><input type="checkbox" value="USD"> <b>ë¯¸êµ­ë‹¬ëŸ¬í™”(USD)</b></label>
      <label><input type="checkbox" value="JPY"> <b>ì¼ë³¸ì—”í™”(JPY)</b></label>
      <label><input type="checkbox" value="EUR"> <b>ìœ ë¡œí™”(EUR)</b></label>
      <label><input type="checkbox" value="AUD"> <b>í˜¸ì£¼ë‹¬ëŸ¬í™”(AUD)</b></label>
      <label><input type="checkbox" value="GBP"> <b>ì˜êµ­íŒŒìš´ë“œí™”(GBP)</b></label>
      <label><input type="checkbox" value="CHF"> <b>ìŠ¤ìœ„ìŠ¤í”„ë‘í™”(CHF)</b></label>
      <label><input type="checkbox" value="CAD"> <b>ìºë‚˜ë‹¤ë‹¬ëŸ¬í™”(CAD)</b></label>
      <label><input type="checkbox" value="CNY"> <b>ì¤‘êµ­ìœ„ì•ˆí™”(CNY)</b></label>
    </div>
    <div class="side-banner-notice">
      * ê·¸ ì™¸ í†µí™”ëŠ” ì˜ì—…ì <br>ê°œë³„ ë¬¸ì˜ ë°”ëë‹ˆë‹¤.
    </div>
    <button class="compare-main-btn" id="mainCompareBtn" style="margin-top:10px;">+ ìƒí’ˆ ë¹„êµí•˜ê¸°</button>
  </div>
  <div th:replace="fragments/dictionary-button :: dictionary-button"></div>
  <div th:replace="~{fragments/footer :: footer}"></div>
  
  <script>
    // ìƒí’ˆ ë°ì´í„°
    const products = [
      {  pno: "P001", name: "ê¿ˆì´ë£¸ ì™¸í™”ììœ ì ê¸ˆ", type: "ì ê¸ˆ", description: "ì™¸í™” ìë™ì´ì²´ë¡œ\nëª©ëˆ ë§ˆë ¨ì„ ì‹œì‘í•˜ì„¸ìš”!", tags: ["#ìë™ì´ì²´", "#ëª©ëˆ ë§ˆë ¨"], currencies: ["USD"], join: ["ì˜ì—…ì  ê°€ì…"], categories: ["study"], img: "img/main/m1.png" },
      {  pno: "P002", name: "BNKëª¨ì•„ë“œë¦¼ì™¸í™”ì ê¸ˆ", type: "ì ê¸ˆ", description: "ì§§ì€ ê¸°ê°„ì—ë„\nê¾¸ì¤€íˆ ì™¸í™”ë¥¼ ëª¨ìœ¼ì„¸ìš”.", tags: ["#í™˜í…Œí¬", "#ë‹¨ê¸°ì €ì¶•"], currencies: ["USD", "EUR", "JPY", "AUD"], join: ["ì˜ì—…ì  ê°€ì…"], categories: ["study"], img: "img/main/m5.png" },
      {  pno: "P003", name: "BNK UP & UP ì™¸í™”ì •ê¸°ì˜ˆê¸ˆ", type: "ì •ê¸°ì˜ˆê¸ˆ", description: "ì˜ˆì¹˜ê¸°ê°„ì´ ëŠ˜ìˆ˜ë¡\nê¸ˆë¦¬ë„ UP!", tags: ["#ì •ê¸°ì˜ˆê¸ˆ", "#ê¸ˆë¦¬ìƒìŠ¹"], currencies: ["USD", "JPY", "EUR"], join: ["ì˜ì—…ì  ê°€ì…"], categories: ["investment"], img: "img/main/m4.png" },
      {  pno: "P004", name: "ì—…ì•¤ì—… ì™¸í™”MMDA", type: "ì…ì¶œê¸ˆì˜ˆê¸ˆ", description: "í•˜ë£¨ë§Œ ë§¡ê²¨ë„\nì´ìê°€ ìŒ“ì—¬ìš”.", tags: ["#ì…ì¶œê¸ˆ", "#ìœ ë™ì„±"], currencies: ["USD", "JPY", "EUR"], join: ["ì˜ì—…ì  ê°€ì…"], categories: ["travel"], img: "img/main/m2.png" },
      {  pno: "P006", name: "ì™¸í™”ì •ê¸°ì˜ˆê¸ˆ", type: "ì •ê¸°ì˜ˆê¸ˆ", description: "ìµœê³  ê¸ˆë¦¬, ì¥ê¸° ì˜ˆì¹˜ì— ì í•©!", tags: ["#ì¥ê¸°ì˜ˆì¹˜", "#ìµœê³ ê¸ˆë¦¬"], currencies: ["USD", "JPY", "GBP", "CHF", "EUR", "AUD", "CAD"], join: ["ì˜ì—…ì  ê°€ì…", "ì¸í„°ë„· ê°€ì…"], categories: ["investment"], img: "img/main/m6.png" },
      {  pno: "P008", name: "ì™¸í™”ë³´í†µì˜ˆê¸ˆ", type: "ì…ì¶œê¸ˆì˜ˆê¸ˆ", description: "ì™¸í™”ë¥¼ ìì£¼\nì…ì¶œê¸ˆí•˜ëŠ” ê³ ê°ì„ ìœ„í•´!", tags: ["#ììœ ì…ì¶œê¸ˆ", "#ê°œì¸ë§ì¶¤"], currencies: ["USD", "JPY", "EUR", "GBP", "CHF", "CAD", "AUD", "CNY"], join: ["ì˜ì—…ì  ê°€ì…"], categories: ["immigration"], img: "img/main/m8.png" },
      {  pno: "P005", name: "EASY í™˜í…Œí¬ ë“€ì–¼í†µì¥", type: "ë³µí•©í˜•", description: "í™˜ìœ¨ ê±±ì • ì—†ì´\nìë™í™˜ì „/ë§¤ë§¤ê¹Œì§€!", tags: ["#í™˜í…Œí¬", "#ìë™ë§¤ë§¤"], currencies: ["USD"], join: ["ì˜ì—…ì  ê°€ì…"], categories: ["travel"], img: "img/main/m3.png" },
      {  pno: "P007", name: "ì™¸í™”ë‹¹ì¢Œì˜ˆê¸ˆ", type: "ì ê¸ˆ", description: "ì›í•˜ëŠ” ê¸°ê°„ì— ë§ì¶°\nì°¨ê³¡ì°¨ê³¡ ëª©ëˆ ì¤€ë¹„!", tags: ["#ëª©ëˆëª¨ìœ¼ê¸°", "#ì •ê¸°ì ê¸ˆ"], currencies: ["USD"], join: ["ì˜ì—…ì  ê°€ì…"], categories: ["investment"], img: "img/main/m7.png" }
    ];

    // ì ‘ê·¼ì„±/ìƒíƒœ ë³€ìˆ˜
    let currentFontSize = 16;
    let soundMode = false;
    let keyboardMode = false;
    let isSpeaking = false;
    let ttsUtter;

    // í˜„ì¬ í•„í„°
    let selectedType = 'all';
    let selectedCategory = '';
    let selectedCurrencies = ['USD'];

    // ë¹„êµí•¨ ìƒíƒœ
    let compareList = [];
    let cardElements = [];
    let cardFocusIdx = 0;

    // í†µí™”ì„ íƒ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸ ì—°ê²°
    document.addEventListener('DOMContentLoaded', function() {
      document.querySelectorAll('.side-banner-currency-list input[type="checkbox"]').forEach(cb => {
        cb.addEventListener('change', function() {
          selectedCurrencies = Array.from(document.querySelectorAll('.side-banner-currency-list input[type="checkbox"]:checked')).map(x=>x.value);
          renderProducts();
        });
      });

      document.querySelectorAll('.filter-buttons button').forEach(btn=>{
        btn.addEventListener('click', function(){
          document.querySelectorAll('.filter-buttons button').forEach(b=>b.classList.remove('active'));
          this.classList.add('active');
          selectedType = this.getAttribute('data-type');
          renderProducts();
        });
      });
      document.querySelectorAll('.category-buttons button').forEach(btn=>{
        btn.addEventListener('click', function(){
          document.querySelectorAll('.category-buttons button').forEach(b=>b.classList.remove('active'));
          if(selectedCategory===this.getAttribute('data-cat')) {
            selectedCategory='';
          } else {
            selectedCategory = this.getAttribute('data-cat');
            this.classList.add('active');
          }
          renderProducts();
        });
      });

      document.getElementById('mainCompareBtn').onclick = function() {
        if(compareList.length>0) {
          showCompareArea();
        }
        animateAllCheckboxes();
      };

      renderProducts();
      updateCompareArea();
      updateDarkModeIcon();
      adjustSideBannerPosition();
    });

    function renderProducts() {
      const grid = document.getElementById('productGrid');
      grid.innerHTML = '';
      let list = products.filter((p, idx) => {
        let okType = (selectedType==='all'||p.type===selectedType);
        let okCat = (!selectedCategory||p.categories.includes(selectedCategory));
        let okCur = (selectedCurrencies.length===0||p.currencies.some(c=>selectedCurrencies.includes(c)));
        return okType && okCat && okCur;
      });
      cardElements = [];
      list.forEach((p, idx)=>{
        const card = document.createElement('div');
        let checked = compareList.findIndex(x=>x.name===p.name)!==-1;
        card.className = 'product-card'+(checked?' selected':'');
        card.tabIndex = 0;
        // ì¹´ë“œ ë³¸ë¬¸
        card.innerHTML = `
          <div class="product-img-wrapper">
            <img src="${p.img}" class="product-img" alt="${p.name}">
            <div class="card-hover-overlay">${p.description.replace(/\n/g,'<br>')}</div>
            <span class="badge">${p.join[0]}</span>
            <input type="checkbox" class="compare-checkbox${checked ? ' animated' : ''}" title="ë¹„êµí•¨ì— ì¶”ê°€" ${checked?'checked':''} tabindex="0">
          </div>
          <div class="product-info">
            <div class="product-name">${p.name} <span class="shield-icon" title="ì˜ˆê¸ˆìë³´í˜¸ ëŒ€ìƒ">ğŸ›¡ï¸</span></div>
            <div class="product-tags">${p.tags.map(t=>`<span>${t}</span>`).join('')}</div>
            <div class="product-currency">${formatCurrencyList(p.currencies)}</div>
          </div>
        `;
        /* â‘  ì‹ ê·œ ì¶”ê°€: ì¹´ë“œ í´ë¦­ ì‹œ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™ */
        card.addEventListener('click', e => {
          // ë¹„êµ ì²´í¬ë°•ìŠ¤ë¥¼ ëˆ„ë¥¼ ë•ŒëŠ” ì´ë™í•˜ì§€ ì•ŠìŒ
          if (e.target.classList.contains('compare-checkbox')) return;
          window.location.href = `/productDetail?pno=${encodeURIComponent(p.pno)}`;
        });
        // ë¹„êµí•¨ +ë²„íŠ¼ ê¸°ëŠ¥/ì• ë‹ˆë©”ì´ì…˜
        let cb = card.querySelector('.compare-checkbox');
        cb.addEventListener('click', function(e) {
          e.stopPropagation();
          if(cb.checked) {
            // ìµœëŒ€ 3ê°œ ì œí•œ
            if(compareList.length>=3) {
              cb.checked = false;
              showCompareLimitMsg();
              return;
            }
            // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
            cb.classList.remove('animated'); void cb.offsetWidth; cb.classList.add('animated');
            compareList.push(p);
          } else {
            compareList = compareList.filter(x=>x.name!==p.name);
          }
          updateCompareArea();
        });
        // ì†Œë¦¬ ì•ˆë‚´(ì ‘ê·¼ì„±)
        card.addEventListener('mouseenter', function(){
          if(soundMode) playCardTTS(p.name, p.description.replace(/\n/g, ', '));
        });
        card.addEventListener('mouseleave', function(){
          if(soundMode) stopTTS();
        });
        // í‚¤ë³´ë“œ ëª¨ë“œì‹œ í¬ì»¤ìŠ¤/Space í‚¤ ì„ íƒ
        card.addEventListener('focus', function(){
          if(keyboardMode) {
            this.querySelector('.card-hover-overlay').classList.add('card-tts-on');
            if(soundMode) playCardTTS(p.name, p.description.replace(/\n/g, ', '));
          }
        });
        card.addEventListener('blur', function(){
          if(keyboardMode) {
            this.querySelector('.card-hover-overlay').classList.remove('card-tts-on');
            stopTTS();
          }
        });
        cardElements.push(card);
        grid.appendChild(card);
      });
      if(keyboardMode && cardElements.length>0) {
        cardElements[0].focus();
      }
      adjustSideBannerPosition();
    }

    // ëª¨ë“  ì¹´ë“œì˜ ì²´í¬ë°•ìŠ¤ì— ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
    function animateAllCheckboxes() {
    	document.querySelectorAll('.compare-checkbox').forEach(cb => {
    	      cb.classList.remove('animated');
    	      void cb.offsetWidth; // ë¦¬í”Œë¡œìš°ë¡œ ì• ë‹ˆë©”ì´ì…˜ ë‹¤ì‹œ ì ìš©
    	      cb.classList.add('animated');
    	    });
    }

    // í†µí™” ì¤„ë°”ê¿ˆ (4ê°œ ì´í•˜ í•œì¤„, ì´ìƒì€ ì¤„ë°”ê¿ˆ)
    function formatCurrencyList(curArr) {
      if(!curArr || curArr.length===0) return '';
      let arr = curArr.map(c=>c.toUpperCase());
      if(arr.length<=4) return `<span style="color:#e60012;">${arr.join(', ')}</span>`;
      return `<span style="color:#e60012;">${arr.slice(0,4).join(', ')}<br>${arr.slice(4).join(', ')}</span>`;
    }

    // ë¹„êµ ì˜ì—­ í‘œì‹œ/ë¹„í™œì„±í™” & íƒ€ì´í‹€
    function showCompareArea() {
      document.getElementById('compareArea').classList.add('active');
      document.getElementById('compareTitle').classList.add('active');
      renderCompareTable();
    }
    function updateCompareArea() {
      const area = document.getElementById('compareArea');
      const title = document.getElementById('compareTitle');
      if(compareList.length===0) {
        area.classList.remove('active');
        title.classList.remove('active');
      } else {
        area.classList.add('active');
        title.classList.add('active');
        renderCompareTable();
      }
      renderProducts(); // í…Œë‘ë¦¬ ë°˜ì˜
    }
    function clearCompare() {
      compareList = [];
      updateCompareArea();
      renderProducts();
    }
    function showCompareLimitMsg() {
      const msg = document.getElementById('compareLimitMsg');
      msg.style.display = 'block';
      setTimeout(()=>{ msg.style.display='none'; }, 1800);
    }
    function renderCompareTable() {
      const table = document.getElementById('compareTable');
      if(compareList.length===0) { table.innerHTML=''; return; }
      let productNumberHeader = `
        <tr>
          <th></th>
          ${compareList.map((_,i)=>`<td><div class="compare-product-header">ìƒí’ˆ${i+1}</div></td>`).join('')}
        </tr>
      `;
      table.innerHTML = `
        ${productNumberHeader}
        <tr>
          <th>ìƒí’ˆëª…</th>
          ${compareList.map(p=>`<td>${p.name}</td>`).join('')}
        </tr>
        <tr>
          <th>ì£¼ìš” íŠ¹ì§•</th>
          ${compareList.map(p=>`<td>${p.description.replace(/\n/g,'<br>')}</td>`).join('')}
        </tr>
        <tr>
          <th>ê°€ì…ë°©ë²•</th>
          ${compareList.map(p=>`<td>${p.join.join('<br>')}</td>`).join('')}
        </tr>
        <tr>
          <th>í†µí™”</th>
          ${compareList.map(p=>`<td>${formatCurrencyList(p.currencies)}</td>`).join('')}
        </tr>
      `;
    }

    // ìƒí’ˆ ê°œë³„ TTS
    function playCardTTS(name, desc) {
      stopTTS();
      ttsUtter = new SpeechSynthesisUtterance(`${name}. ${desc}`);
      ttsUtter.lang = 'ko-KR';
      speechSynthesis.speak(ttsUtter);
      isSpeaking = true;
    }
    function stopTTS() {
      if(isSpeaking) {
        speechSynthesis.cancel();
        isSpeaking = false;
      }
    }

    // ì ‘ê·¼ì„± í† ê¸€
    function increaseFontSize() {
      if(currentFontSize < 24) currentFontSize++;
      document.documentElement.style.fontSize = currentFontSize + 'px';
    }
    function decreaseFontSize() {
      if(currentFontSize > 12) currentFontSize--;
      document.documentElement.style.fontSize = currentFontSize + 'px';
    }
    function toggleTTS() {
      if(isSpeaking) {
        speechSynthesis.cancel();
        isSpeaking = false;
        document.getElementById('ttsBtn').querySelector('span[aria-hidden]').textContent = 'ğŸ”Š';
      } else {
        const text = document.querySelector('.container-main').innerText;
        ttsUtter = new SpeechSynthesisUtterance(text);
        ttsUtter.lang = 'ko-KR';
        ttsUtter.onend = () => {
          isSpeaking = false;
          document.getElementById('ttsBtn').querySelector('span[aria-hidden]').textContent = 'ğŸ”Š';
        };
        speechSynthesis.speak(ttsUtter);
        isSpeaking = true;
        document.getElementById('ttsBtn').querySelector('span[aria-hidden]').textContent = 'â¹ï¸';
      }
    }
    function toggleSoundMode() {
      soundMode = !soundMode;
      document.getElementById('soundModeIcon').textContent = soundMode ? 'ğŸ”Š' : 'ğŸ”ˆ';
      if (!soundMode) stopTTS();
    }
    function toggleKeyboardMode() {
      keyboardMode = !keyboardMode;
      document.getElementById('keyboardModeIcon').textContent = keyboardMode ? 'â¹ï¸' : 'âŒ¨ï¸';
      if(keyboardMode && cardElements.length>0) {
        cardFocusIdx = 0;
        cardElements[0].focus();
      }
    }
    function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
      updateDarkModeIcon();
    }
    function updateDarkModeIcon() {
      const icon = document.getElementById('darkModeIcon');
      if (document.body.classList.contains('dark-mode')) {
        icon.textContent = 'â˜€ï¸';
      } else {
        icon.textContent = 'ğŸŒ™';
      }
    }

    // í‚¤ë³´ë“œ í™”ì‚´í‘œ/íƒ­/ì—”í„° ì´ë²¤íŠ¸ (í‚¤ë³´ë“œ ëª¨ë“œ í™œì„±í™” ì‹œ)
    document.addEventListener('keydown', function(e){
      if(!keyboardMode || cardElements.length===0) return;
      if(document.activeElement.classList.contains('product-card')) {
        if(e.key==="ArrowRight"||e.key==="ArrowDown") {
          cardFocusIdx = (cardFocusIdx+1)%cardElements.length;
          cardElements[cardFocusIdx].focus();
          e.preventDefault();
        }
        if(e.key==="ArrowLeft"||e.key==="ArrowUp") {
          cardFocusIdx = (cardFocusIdx-1+cardElements.length)%cardElements.length;
          cardElements[cardFocusIdx].focus();
          e.preventDefault();
        }
      }
    });

    // ê´‘ê³  ë°°ë„ˆ ìœ„ì¹˜ ì¡°ì •
    function adjustSideBannerPosition() {
      const grid = document.querySelector('.product-grid');
      const banner = document.getElementById('sideBanner');
      if (grid && banner) {
        const rect = grid.getBoundingClientRect();
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        const top = rect.top + scrollTop;
        banner.style.top = top + 'px';
      }
    }
    window.addEventListener('resize', adjustSideBannerPosition);
    window.addEventListener('scroll', adjustSideBannerPosition);
    document.addEventListener('DOMContentLoaded', () => {
        fetch('/product/names')
          .then(res => res.json())
          .then(names => {
            // productsëŠ” ì´ë¯¸ ì„ ì–¸ë˜ì–´ ìˆìŒ (í•˜ë“œì½”ë”© ë°ì´í„°)
            const filtered = products.filter(p => names.includes(p.name));
            products.length = 0; // ê¸°ì¡´ ë°°ì—´ ë¹„ìš°ê¸°
            filtered.forEach(p => products.push(p)); // í™œì„±í™” ìƒí’ˆë§Œ ë‹¤ì‹œ ì±„ìš°ê¸°
            renderProducts(); // ìƒí’ˆ ë‹¤ì‹œ ë Œë”ë§
          })
          .catch(err => {
            console.error("ìƒí’ˆëª… ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", err);
          });
      });
  </script>
</body>
</html>
